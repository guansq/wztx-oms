{extend name='extra@admin/content' /}

{block name="button"}

{/block}

{block name="content"}

<main class="main">
    <div class="head_box">
        <a href="javascript:void(0);">订单管理</a>
        <span> >> </span>
        <a href="javascript:void(0);">订单列表</a>
        <span> >> </span>
        <a href="javascript:void(0);">订单详情</a>
    </div>
    <div class="con_box">
        <p class="p_tit"><span class="glyphicon glyphicon-align-justify"></span>订单详情</p>
        <div class="details_box">
            <div class="datails_tit">
                <span class="hr_span"></span>
                <h3>基本信息</h3>
                <span class="hr_span"></span>
            </div>
            <div class="info_table">
                <table class="table table-bordered">
                    <tbody>
                    <tr>
                        <td class="col-sm-6">订单状态</td>
                        <td class="col-sm-6">{$list.statusname|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">订单号</td>
                        <td class="col-sm-6">{$list.order_code|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">货品名称</td>
                        <td class="col-sm-6">{$list.goods_name|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">重量</td>
                        <td class="col-sm-6">{$list.weight|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">体积</td>
                        <td class="col-sm-6">{$list.volume|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">起始地</td>
                        <td class="col-sm-6">{$list.org_address_name|default=''}{$list.org_address_detail|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">保险状态</td>
                        <td class="col-sm-6">
                            {if condition="$list.premium_amount gt '0'"}
                            参保
                            {else /}
                            未参保
                            {/if}
                        </td>

                    </tr>
                    <tr>
                        <td class="col-sm-6">保险额度</td>
                        <td class="col-sm-6">{:number_format($list.insured_amount,2)}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">保险费用</td>
                        <td class="col-sm-6">{:number_format($list.premium_amount,2)}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">目的地</td>
                        <td class="col-sm-6">{$list.dest_address_name|default=''}{$list.dest_address_detail|default=''}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="authentication">
            <div class="datails_tit">
                <span class="hr_span"></span>
                <h3>收货信息</h3>
                <span class="hr_span"></span>
            </div>
            <div class="info_table">
                <table class="table table-bordered">
                    <tbody>
                    <tr>
                        <td class="col-sm-6">收货人姓名</td>
                        <td class="col-sm-6">{$list.dest_receive_name|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">收货人电话</td>
                        <td class="col-sm-6">{$list.dest_phone|default=''}/{$list.dest_telphone|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">收货人地址</td>
                        <td class="col-sm-6">{$list.dest_address_name|default=''}{$list.dest_address_detail|default=''}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="authentication">
            <div class="datails_tit">
                <span class="hr_span"></span>
                <h3>寄件信息</h3>
                <span class="hr_span"></span>
            </div>
            <div class="info_table">
                <table class="table table-bordered">
                    <tbody>
                    <tr>
                        <td class="col-sm-6">寄件人姓名</td>
                        <td class="col-sm-6">{$list.org_send_name|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">寄件人电话</td>
                        <td class="col-sm-6">{$list.org_phone}/{$list.org_telphone}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">寄件人地址</td>
                        <td class="col-sm-6">{$list.org_address_name}{$list.org_address_detail}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="authentication">
            <div class="datails_tit">
                <span class="hr_span"></span>
                <h3>车辆信息</h3>
                <span class="hr_span"></span>
            </div>
            <div class="info_table">
                <table class="table table-bordered">
                    <tbody>
                    <tr>
                        <td class="col-sm-6">车型</td>
                        <td class="col-sm-6">{$list.car_style_type}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">车长</td>
                        <td class="col-sm-6">{$list.car_style_length}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">用车时间</td>
                        <td class="col-sm-6">{if condition="$list.usecar_time neq ''"}{$list.usecar_time|date='Y-m-d',###}{/if}
                        </td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">发货时间</td>
                        <td class="col-sm-6">{if condition="$list.send_time neq ''"}{$list.send_time|date='Y-m-d',###}{/if}
                        </td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">到达时间</td>
                        <td class="col-sm-6">{if condition="$list.arr_time neq  ''"}{$list.arr_time|date='Y-m-d',###}{/if}
                        </td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">车主姓名</td>
                        <td class="col-sm-6">{$carinfo.real_name|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">联系电话</td>
                        <td class="col-sm-6">{$carinfo.phone|default=''}</td>
                    </tr>
                    <tr>
                        <td class="col-sm-6">总运费</td>
                        <td class="col-sm-6">{$list.final_price}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        {if $pay_cer_pic|@count neq 0 }
        <div class="authentication">
            <div class="datails_tit">
                <span class="hr_span"></span>
                <h3>凭证信息</h3>
                <span class="hr_span"></span>
            </div>
            {volist name="pay_cer_pic" id="ppay_cer_pic"}
            <div class="auth_box">
                <section class="auth_img">
                    <img src="{$ppay_cer_pic}" style="height: 150px;">
                </section>
            </div>
            {/volist}

            <div class="auth_box">
                <section class="auth_btn">
                    {if condition="$list.per_status eq 'check'"}
                    <button type="button" class="btn btn-primary" id="pass">通过审核</button>
                    <button type="button" class="btn btn-primary" id="refuse" data-reason="确定拒绝审核？">拒绝审核</button>
                    {/if}
                    {if condition="$list.per_status eq 'pass'"}
                    <button type="button" class="btn btn-primary">已经通过审核</button>
                    <button type="button" class="btn btn-primary" disabled="disabled">拒绝审核</button>
                    {/if}
                    {if condition="$list.per_status eq 'refuse'"}
                    <button type="button" class="btn btn-primary" disabled="disabled">通过审核</button>
                    <button type="button" class="btn btn-primary" disabled="disabled">{$list.per_remark}</button>
                    {/if}
                </section>
            </div>
        </div>
        {/if}

    </div>
</main>

{/block}

{block name="script"}
<script>
    var detailid = '{$list.id}';
    $("#pass").click(function () {
        layer.confirm('是否通过审核', {
            btn: ['确定', '取消']
        }, function (index) {
            layer.close(index);
            layer.load();
            $.ajax({
                'url': '{:url("Order/pass")}',
                'type': 'POST',
                'data': {
                    'id': detailid
                },
                'complete': function () {
                },
                'success': function (obj) {
                    layer.closeAll();
                    if (obj.code == 2000) {
                        layer.msg('通过审核', function () {
                            location.reload();
                        });
                    } else {
                        layer.alert(obj.msg);
                    }
                },
                'error': function () {
                    layer.closeAll();
                    layer.alert('请求失败');
                }
            });
        });
    })
    $("#refuse").click(function () {
        var titile = $(this).attr('data-reason');
        var type = $(this).attr('id');
        layer.prompt({
            formType: 0,
            value: '',
            title: titile,
        }, function (value, index, elem) {
            //alert(value); //得到value
            layer.close(index);
            layer.load();
            $.ajax({
                'url': '{:url("Order/auth")}',
                'type': 'POST',
                'data': {
                    'id': detailid,
                    'type': type,
                    'title': value,
                },
                'complete': function () {
                },
                'success': function (obj) {
                    layer.closeAll();
                    if (obj.code == 2000) {
                        layer.msg('操作成功', function () {
                            location.reload();
                        });
                    } else {
                        layer.alert(obj.msg);
                    }
                },
                'error': function () {
                    layer.closeAll();
                    layer.alert('请求失败');
                }
            });
        });
    })
</script>
<script>
    //调用示例
    layer.photos({
        photos: '.auth_img'
        ,anim: 5 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
    });
</script>
{/block}
